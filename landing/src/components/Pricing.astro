---
const checkIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="mt-0.5 shrink-0 text-vapor-purple"><polyline points="20 6 9 17 4 12"/></svg>`;

const dashIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="mt-0.5 shrink-0 text-vapor-muted/60"><line x1="5" y1="12" x2="19" y2="12"/></svg>`;

function highlightValues(text: string): string {
  return text
    .replace(/(\d+)/g, '<span class="text-vapor-accent font-bold">$1</span>')
    .replace(/(Unlimited)/g, '<span class="text-vapor-accent font-bold">$1</span>');
}

const tiers = [
  {
    name: 'Free',
    price: '$0',
    period: '/month',
    description: 'Try VaporForge with no commitment.',
    badge: null,
    highlighted: false,
    highlightNums: false,
    features: [
      { text: '1 concurrent session', included: true },
      { text: '2 hours/day limit', included: true },
      { text: '1/4 vCPU, 1 GiB RAM', included: true },
      { text: '4 GB disk', included: true },
      { text: '10 MB file upload', included: true },
      { text: 'Ephemeral storage', included: true },
      { text: 'Secrets management', included: false },
      { text: 'File export', included: false },
      { text: 'Custom CLAUDE.md', included: false },
      { text: 'MCP relay (local tools)', included: false },
    ],
    cta: 'Get Started',
    ctaHref: '/app',
    ctaStyle: 'border',
  },
  {
    name: 'Pro',
    price: '$20',
    period: '/month',
    description: 'Everything you need to code from anywhere.',
    badge: 'Most Popular',
    highlighted: true,
    highlightNums: false,
    features: [
      { text: '3 concurrent sessions', included: true },
      { text: 'Unlimited usage', included: true },
      { text: '1 vCPU, 6 GiB RAM', included: true },
      { text: '12 GB disk', included: true },
      { text: '100 MB file upload', included: true },
      { text: '7-day persistence', included: true },
      { text: '10 secrets per project', included: true },
      { text: 'File export', included: true },
      { text: 'Custom CLAUDE.md', included: true },
      { text: 'MCP relay (local tools)', included: true },
    ],
    cta: 'Coming Soon',
    ctaHref: null,
    ctaStyle: 'primary',
  },
  {
    name: 'Premium',
    price: '$80',
    period: '/month',
    description: 'Maximum power for heavy workloads.',
    badge: 'Power Users',
    highlighted: false,
    highlightNums: true,
    features: [
      { text: '10 concurrent sessions', included: true },
      { text: 'Unlimited usage', included: true },
      { text: '4 vCPU, 12 GiB RAM', included: true },
      { text: '20 GB disk', included: true },
      { text: '1 GB file upload', included: true },
      { text: '30-day persistence', included: true },
      { text: 'Unlimited secrets', included: true },
      { text: 'File export', included: true },
      { text: 'Custom CLAUDE.md', included: true },
      { text: 'MCP relay (local tools)', included: true },
    ],
    cta: 'Coming Soon',
    ctaHref: null,
    ctaStyle: 'border',
  },
];
---

<section id="pricing" class="relative px-4 py-20 sm:px-6 sm:py-28 cyber-lines">
  <div class="absolute left-1/2 top-1/4 -translate-x-1/2 h-[300px] w-[300px] rounded-full bg-vapor-purple/6 blur-[120px] pointer-events-none" />
  <div class="absolute right-1/4 bottom-1/3 h-[200px] w-[200px] rounded-full bg-vapor-accent/6 blur-[100px] pointer-events-none" />

  <div class="relative z-10 mx-auto max-w-6xl">
    <div class="text-center">
      <h2 class="font-display text-3xl font-bold tracking-wide sm:text-4xl cyber-glow">
        Simple, transparent pricing
      </h2>
      <p class="mt-4 text-vapor-muted max-w-lg mx-auto">
        Three tiers. No API costs. Bring your own Claude subscription.
      </p>
    </div>

    <div class="mt-14 grid gap-6 md:grid-cols-3">
      {tiers.map((tier) => (
        <div
          class:list={[
            'relative rounded-2xl p-px transition-all duration-300 hover:-translate-y-1',
            tier.highlighted
              ? 'bg-gradient-to-br from-vapor-purple/50 via-vapor-accent/30 to-vapor-purple-dark/50 hover:shadow-xl hover:shadow-vapor-purple/15'
              : 'bg-vapor-purple-bg/30 hover:shadow-lg hover:shadow-vapor-purple/10',
          ]}
        >
          {tier.badge && (
            <div class="absolute -top-3.5 left-1/2 -translate-x-1/2 z-10">
              <span class="font-display rounded-full bg-gradient-to-r from-vapor-accent to-vapor-purple px-4 py-1 text-[10px] font-semibold tracking-widest text-white uppercase whitespace-nowrap">
                {tier.badge}
              </span>
            </div>
          )}

          <div
            class:list={[
              'rounded-2xl p-6 sm:p-8 h-full flex flex-col',
              tier.highlighted ? 'bg-vapor-card' : 'bg-vapor-card/80',
            ]}
          >
            <div class="text-center">
              <h3 class="font-display text-sm font-semibold tracking-widest uppercase text-vapor-muted">
                {tier.name}
              </h3>
              <div class="mt-4">
                <span
                  class:list={[
                    'font-display text-4xl sm:text-5xl font-bold',
                    tier.highlighted ? 'cyber-gradient-text' : 'text-white',
                  ]}
                >
                  {tier.price}
                </span>
                <span class="text-vapor-muted text-sm">{tier.period}</span>
              </div>
              <p class="mt-2 text-sm text-vapor-muted">
                {tier.description}
              </p>
            </div>

            <ul class="mt-8 space-y-3 flex-1">
              {tier.features.map((feature) => (
                <li class="flex items-start gap-3 text-sm text-vapor-muted">
                  <Fragment set:html={feature.included ? checkIcon : dashIcon} />
                  {feature.included && tier.highlightNums ? (
                    <span set:html={highlightValues(feature.text)} />
                  ) : (
                    <span class:list={[!feature.included && 'opacity-70']}>
                      {feature.text}
                    </span>
                  )}
                </li>
              ))}
            </ul>

            <div class="mt-8">
              {tier.ctaHref ? (
                <a
                  href={tier.ctaHref}
                  class:list={[
                    'block w-full rounded-lg px-6 py-3 text-sm font-semibold text-center font-display tracking-wide transition-all',
                    tier.ctaStyle === 'primary'
                      ? 'cyber-btn text-white hover:shadow-lg hover:shadow-vapor-purple/25'
                      : 'border border-vapor-purple-bg text-white hover:border-vapor-purple/50 hover:text-vapor-purple',
                  ]}
                >
                  {tier.cta}
                </a>
              ) : (
                <button
                  disabled
                  class:list={[
                    'block w-full rounded-lg px-6 py-3 text-sm font-semibold text-center font-display tracking-wide cursor-not-allowed',
                    tier.ctaStyle === 'primary'
                      ? 'bg-vapor-purple-bg text-vapor-muted'
                      : 'bg-vapor-purple-bg/50 text-vapor-muted/70',
                  ]}
                >
                  {tier.cta}
                </button>
              )}
            </div>

            <p class="mt-3 text-center text-[11px] text-vapor-muted/60">
              Requires Claude Pro or Max subscription.
            </p>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
